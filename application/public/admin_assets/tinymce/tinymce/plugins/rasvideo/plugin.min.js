tinymce.PluginManager.add("rasvideo",function(e,i){function t(){var i,t;i=o(),t={window:window,editor_id:e.editor_id,popup:i},popup=e.windowManager.open(i,t),$(e.selection.getNode()).hasClass("mceNonEditable")&&$(e.selection.getNode()).hasClass("videoPlugin")&&""!==$(e.selection.getNode()).html()&&$("#embedVideo").ready(function(){$("#embedVideo").html($(e.selection.getNode()).html()).promise().done(function(){$("#previewVideo").html($("#embedVideo").val()),$("#videoTitle").val($(e.selection.getNode()).data("title"))})})}function o(){var e,i='<div style="overflow: hidden;padding:0 0 20px 40px;"><label for="videoTitle" style="display:block;float:left">Unesite naslov videa:</label><input type="text" value="" size="20" id="videoTitle" name="videoTitle" style="float:left;width:400px;border:1px solid lightgray;height:30px;" /></div><div style="float:left;width:32%;margin-right:20px;height:480px"><label for="embedVideo" style="display:block;">Unesite embed kod:</label><textarea id="embedVideo" style="border:solid 1px lightgray;width:100%;height:95%;white-space:normal;" name="embedVideo"></textarea></div><div id="previewVideo" style="float:left;height:83%;width:65%"></div>';return e={title:"Embed video",width:900,height:550,close_previous:"no",resizable:"yes",autoscroll:"yes",body:[{title:"Enter embed code",type:"panel",html:i}],buttons:[{text:"Preview",onclick:function(){l()}},{text:"Insert",onclick:function(){d()}},{text:"Close",onclick:function(){tinymce.activeEditor.windowManager.close()}}]}}function d(){var e=null;if("undefined"!=typeof $(tinyMCE.activeEditor.selection.getNode()).data("bodyVideoId")&&(e=$(tinyMCE.activeEditor.selection.getNode()).data("bodyVideoId")),detectPlugin("rasvideo"),""!==$("#embedVideo").val()){var i=null;"undefined"!=typeof getParams().articleId&&(i=getParams().articleId);var t={code:$("#embedVideo").val(),title:$("#videoTitle").val(),articleId:i,videoId:e};$.post("/backend/article/saveVideo",t,function(e){if(e){var i='<div class="mceNonEditable pluginContainer videoPlugin videoWrapper twelvecol '+n($("#embedVideo").val())+'" data-video-plugin="1" data-title="'+$("#videoTitle").val()+'" data-body-video-id="'+e+'">';i+=$("#embedVideo").val(),i+="</div>",i+='<p><br data-mce-bogus="1"></p>',editorGlobal.insertContent(i),popup.close()}else alert("Failed to save video.")})}else popup.close()}function n(e){var i="unknown";return-1!==e.indexOf("you.")||-1!==e.indexOf("youtube")?i="youtubeVideo":-1!==e.indexOf("vimeo")?i="vimeoVideo":-1!==e.indexOf("facebook")?i="facebookVideo":-1!==e.indexOf("dailymotion")?i="dailymotionVideo":-1!==e.indexOf("vine.co")?i="vineVideo":-1!==e.indexOf("liveleak")?i="liveleakVideo":-1!==e.indexOf("break.com")?i="breakVideo":-1!==e.indexOf("mvp")&&(i="onetVideo"),i}function l(){$("#previewVideo").html($("#embedVideo").val())}e.addButton("rasvideo",{icon:"none",image:i+"../../../../../css/images/flash_icon.png",text:"Embed video",tooltip:"Insert video from another site",stateSelector:"div[data-video-plugin]",onclick:function(){t(e)}}),e.addMenuItem("rasvideo",{text:"Edit plugin",image:i+"../../../../../css/images/flash_icon.png",onPostRender:function(){handleDisabledState(this,"div.videoPlugin")},context:"delete",prependToContext:!0,menu:[{text:"Edit this video",onclick:function(){e.focus(),t(e)},context:"insert"},{text:"Remove video",onclick:function(){deletePlugin("videoPlugin")},context:"delete"}]})});